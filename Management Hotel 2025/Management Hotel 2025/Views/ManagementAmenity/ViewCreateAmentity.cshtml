@{
    Layout = null; // Bỏ nếu bạn dùng _Layout chung
}
<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tạo mục mới — Hai cột: Ảnh (trái lớn) + Form (phải)</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

    <style>
        body {
            background: #f8f9fa;
            min-height: 100vh;
        }

        .main-card {
            max-width: 1200px;
            margin: 28px auto;
            border: 0;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 6px 24px rgba(0,0,0,0.07);
            background: #fff;
        }

        .left-preview {
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 64vh;
            max-height: 92vh;
            position: relative;
            overflow: hidden;
        }

            .left-preview img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                display: block;
            }

        .left-placeholder {
            color: #6c757d;
            text-align: center;
            padding: 1rem;
            font-size: 1.05rem;
        }

        .right-form {
            padding: 30px;
        }

        .file-input {
            display: none;
        }

        .btn-upload {
            display: inline-flex;
            align-items: center;
        }

        @@media (max-width: 991.98px) {
            .left-preview

        {
            min-height: 40vh;
        }

        }

        @@media (max-width: 767.98px) {
            .left-preview

        {
            min-height: 32vh;
        }

        .right-form {
            padding: 18px;
        }

        }

        #fileName {
            word-break: break-all;
            max-width: 220px;
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card main-card">
            <div class="row g-0">
                <div class="col-md-8 col-12 left-preview" id="leftPreview" aria-label="Khu vực xem trước ảnh">
                    <div class="left-placeholder" id="leftPlaceholder">
                        Chưa có ảnh<br />
                        Kéo thả ảnh vào đây hoặc bấm "Chọn ảnh" ở bên phải
                    </div>
                </div>

                <div class="col-md-4 col-12 right-form">
                    <h4 class="mb-3">Tạo mới tiện ích</h4>

                    <form id="createForm" onsubmit="return false;">
                        <div class="mb-3">
                            <label class="btn btn-primary btn-upload me-2" for="fileInput" id="chooseBtn">
                                Chọn ảnh
                            </label>
                            <input id="fileInput" class="file-input" type="file" accept="image/*" />
                            <small id="fileName" class="text-muted ms-2">Không có tệp nào được chọn</small>
                            <button id="clearImageBtn" type="button" class="btn btn-outline-secondary btn-sm ms-2" style="display:none;">
                                Xoá
                            </button>
                        </div>

                        <div class="mb-3">
                            <label for="nameInput" class="form-label">Tên <span class="text-danger">*</span></label>
                            <input id="nameInput" type="text" class="form-control" placeholder="Nhập tên..." required />
                        </div>

                        <div class="mb-3">
                            <label for="descInput" class="form-label">Mô tả</label>
                            <textarea id="descInput" class="form-control" rows="6" placeholder="Nhập mô tả..."></textarea>
                        </div>

                        <div class="d-flex align-items-center mb-3">
                            <select id="statusInput" class="form-select me-3" style="width:auto;">
                                <option value="Active" selected>Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                            <button id="createBtn" type="button" class="btn btn-success" disabled>Tạo mới</button>
                            <div id="feedback" class="text-muted small ms-3"></div>
                        </div>

                        <hr />
                        <div class="small text-muted">
                            Ghi chú: Nút "Tạo" sẽ kích hoạt khi đã chọn ảnh và nhập tên. Ảnh không được quá 5MB.
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        (function () {
            const fileInput = document.getElementById('fileInput');
            const leftPreview = document.getElementById('leftPreview');
            const leftPlaceholder = document.getElementById('leftPlaceholder');
            const fileNameEl = document.getElementById('fileName');
            const clearImageBtn = document.getElementById('clearImageBtn');
            const nameInput = document.getElementById('nameInput');
            const descInput = document.getElementById('descInput');
            const statusInput = document.getElementById('statusInput');
            const createBtn = document.getElementById('createBtn');
            const feedback = document.getElementById('feedback');

            let currentFile = null;

            function updateCreateButtonState() {
                const hasFile = !!currentFile;
                const hasName = nameInput.value.trim().length > 0;
                createBtn.disabled = !(hasFile && hasName);
            }

            function clearPreview() {
                currentFile = null;
                const img = leftPreview.querySelector('img');
                if (img) img.remove();
                leftPlaceholder.style.display = 'block';
                fileNameEl.textContent = 'Không có tệp nào được chọn';
                clearImageBtn.style.display = 'none';
                updateCreateButtonState();
            }

            fileInput.addEventListener('change', function (e) {
                const file = e.target.files && e.target.files[0];
                handleFileSelected(file);
            });

            leftPreview.addEventListener('dragover', function (e) {
                e.preventDefault();
                leftPreview.style.background = '#f1f3f5';
            });
            leftPreview.addEventListener('dragleave', function (e) {
                leftPreview.style.background = '';
            });
            leftPreview.addEventListener('drop', function (e) {
                e.preventDefault();
                leftPreview.style.background = '';
                const file = e.dataTransfer.files && e.dataTransfer.files[0];
                if (file) {
                    try {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        fileInput.files = dataTransfer.files;
                    } catch {}
                    handleFileSelected(file);
                }
            });

            function handleFileSelected(file) {
                if (!file) {
                    clearPreview();
                    return;
                }

                if (!file.type.startsWith('image/')) {
                    alert('Vui lòng chọn tệp hình ảnh (jpg, png, ...).');
                    fileInput.value = '';
                    clearPreview();
                    return;
                }

                const maxBytes = 5 * 1024 * 1024; // 5MB
                if (file.size > maxBytes) {
                    alert('Kích thước ảnh quá lớn. Vui lòng chọn ảnh < 5MB.');
                    fileInput.value = '';
                    clearPreview();
                    return;
                }

                fileNameEl.textContent = file.name;
                clearImageBtn.style.display = 'inline-block';

                const reader = new FileReader();
                reader.onload = function (ev) {
                    leftPlaceholder.style.display = 'none';
                    let img = leftPreview.querySelector('img');
                    if (!img) {
                        img = document.createElement('img');
                        img.alt = 'Ảnh xem trước';
                        leftPreview.appendChild(img);
                    }
                    img.src = ev.target.result;
                };
                reader.readAsDataURL(file);

                currentFile = file;
                updateCreateButtonState();
            }

            clearImageBtn.addEventListener('click', function () {
                fileInput.value = '';
                clearPreview();
            });

            nameInput.addEventListener('input', updateCreateButtonState);

            createBtn.addEventListener('click', function () {
                if (!currentFile) return alert('Vui lòng chọn ảnh.');
                const name = nameInput.value.trim();
                if (!name) return alert('Vui lòng nhập tên.');
                const desc = descInput.value.trim();
                const status = statusInput.value;

                const formData = new FormData();
                formData.append('Name', name);
                formData.append('Status', status);
                formData.append('Description', desc);
                formData.append('UpdateImage', currentFile); // trùng với server

                feedback.textContent = 'Đang tạo...';
                createBtn.disabled = true;

                fetch('/admin/amenity', { // gửi đúng route server
                    method: 'POST',
                    body: formData
                })
                .then(res => res.json())
                .then(data => {
                    if(data.status){
                        feedback.innerHTML = 'Đã tạo: <strong>' + escapeHtml(name) + '</strong>';
                        clearPreview();
                        nameInput.value = '';
                        descInput.value = '';
                    } else {
                        feedback.textContent = data.message || 'Có lỗi xảy ra.';
                    }
                    createBtn.disabled = false;
                    updateCreateButtonState();
                })
                .catch(err => {
                    feedback.textContent = 'Có lỗi xảy ra.';
                    createBtn.disabled = false;
                    console.error(err);
                });
            });

            function escapeHtml(str) {
                return str.replace(/[&<>"']/g, function (m) {
                    return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]);
                });
            }

            clearPreview();
            updateCreateButtonState();
        })();
    </script>
</body>
</html>
