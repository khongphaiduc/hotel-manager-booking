@model List<Management_Hotel_2025.ViewModel.BookingInfo>
@{
    ViewBag.Title = "Lịch đặt phòng";
    Layout = null;
}

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

<style>
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #f7fafc;
    }

    .fullscreen-calendar-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(135deg, #f7fafc 80%, #fffbe6 100%);
        display: flex;
        flex-direction: column;
        align-items: stretch;
        justify-content: flex-start;
        z-index: 10;
    }

    .calendar-header {
        width: 100vw;
        padding: 1.2rem 2rem 0.2rem 2rem;
        font-size: 1.9rem;
        font-weight: 700;
        background: transparent;
        color: #59a659;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

        .calendar-header .bi {
            font-size: 2.2rem;
            color: #ffd666;
        }

    #calendar {
        flex: 1;
        width: 100vw;
        height: calc(100vh - 4.5rem);
        max-width: 100vw;
        margin: 0 auto;
        background: #fff;
        border-radius: 0px;
        box-shadow: none;
        padding: 0;
        /* Ensure calendar takes full size */
    }

    .booking-tooltip-popup {
        position: absolute;
        background: transparent;
        color: inherit;
        pointer-events: none;
        min-width: 230px;
        max-width: 380px;
        z-index: 10000;
    }

    .booking-tooltip-inner-yellow {
        background: linear-gradient(135deg, #fffbe6 80%, #fff1b8 100%);
        color: #5a4000;
        border-radius: 18px;
        box-shadow: 0 8px 32px rgba(160,130,60,0.25);
        border: 2px solid #ffe58f;
        padding: 1.2rem 1.5rem;
        font-size: 1.13rem;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        pointer-events: auto;
        animation: fadeIn 0.22s;
    }
    @@keyframes fadeIn {
        from

    {
        opacity: 0;
        transform: translateY(-12px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }

    }

    #calendar .fc-toolbar {
        font-size: 1.24rem;
        padding: 1.2rem 0.5rem 0.5rem 0.5rem;
    }

    #calendar .fc-toolbar-title {
        font-size: 1.45rem;
        font-weight: 700;
        color: #59a659;
    }

    #calendar .fc-daygrid-event {
        border-radius: 11px !important;
        box-shadow: 0 2px 10px rgba(80,160,100,0.08);
        min-height: 21px;
        padding: 0 !important;
        margin: 3px 0;
    }

    #calendar .fc-event {
        font-size: 1.07rem;
        transition: background 0.22s;
        cursor: pointer;
    }

        #calendar .fc-event:hover {
            background-color: #ffe58f !important;
            opacity: 0.97;
        }

    .fc-daygrid-day-number {
        font-size: 1.14rem;
        font-weight: 600;
        color: #59a659;
    }
</style>

<div class="fullscreen-calendar-container">
    <div class="calendar-header">
        <i class="bi bi-calendar2-week-fill"></i>
        Lịch đặt phòng @ViewBag.NumberRoom
    </div>
    <div id="calendar"></div>
    <div id="bookingTooltip" class="booking-tooltip-popup" style="display:none;"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var tooltipEl = document.getElementById('bookingTooltip');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'vi',
            themeSystem: 'bootstrap5',
            height: '100%',
            contentHeight: '100%',
            expandRows: true,
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek'
            },
            events: [
    @foreach (var booking in Model)
    {
        var days = (booking.EndDate - booking.StartDate).Days + 1;
        <text>
                            {
                                title: '',
                                start: '@booking.StartDate.ToString("yyyy-MM-dd")',
                                end: '@booking.EndDate.AddDays(1).ToString("yyyy-MM-dd")',
                                backgroundColor: '#d1f7c4',
                                borderColor: '#ffe58f',
                                opacity: 0.90,
                                extendedProps: {
                                    customerName: '@booking.CustomerName',
                                    startDate: '@booking.StartDate.ToString("dd/MM/yyyy")',
                                    endDate: '@booking.EndDate.ToString("dd/MM/yyyy")',
                                    bookedDays: '@days'
                                }
                            },
        </text>
    }
            ],
            eventDidMount: function(info) {
                info.el.addEventListener('mouseenter', function(e) {
                    var rect = info.el.getBoundingClientRect();
                    var scrollY = window.scrollY || window.pageYOffset;
                    var scrollX = window.scrollX || window.pageXOffset;
                    tooltipEl.innerHTML = `
                        <div class="booking-tooltip-inner-yellow">
                            <div class="fw-bold text-dark mb-1" style="font-size:1.18rem;">
                                <i class="bi bi-person-bounding-box me-1"></i> ${info.event.extendedProps.customerName}
                            </div>
                            <div class="mb-1 text-dark" style="font-size:1.07rem;">
                                <i class="bi bi-calendar-event"></i>
                                <b>Thời gian:</b>
                                <span class="text-success">${info.event.extendedProps.startDate} - ${info.event.extendedProps.endDate}</span>
                            </div>
                            <div class="mb-0 text-dark" style="font-size:1.07rem;">
                                <i class="bi bi-clock-history"></i>
                                <b>Tổng số ngày booking:</b>
                                <span class="badge bg-warning-subtle text-dark ms-1">${info.event.extendedProps.bookedDays} ngày</span>
                            </div>
                        </div>
                    `;
                    tooltipEl.style.display = 'block';
                    tooltipEl.style.top = (rect.top + scrollY - tooltipEl.offsetHeight - 16) + 'px';
                    tooltipEl.style.left = (rect.left + scrollX + rect.width / 2 - tooltipEl.offsetWidth / 2) + 'px';
                });
                info.el.addEventListener('mouseleave', function(e){
                    tooltipEl.style.display = 'none';
                });
            }
        });
        calendar.render();
    });
</script>